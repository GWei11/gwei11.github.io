---
title: java内存模型
categories:
	- [java, jvm]
tags:
	- java
	- jvm
---

# java内存模型(java memory mode)

`java`内存模型实际上是一个抽象的概念，是一套规范，而不是一个实际的东西，而`java`内存结构就是根据这一套规范来进行划分的。可以先看另一篇文章。

[jvm](https://gwei11.gitee.io/2020/04/23/java/jvm/jvm/#more)

<!--more-->

## 什么是`java`内存模型(JMM规范)

`jvm`将内存组织结构主要划分为两个部分

* 主内存
* 工作内存

### 主内存

* 主要包含本地方法区和堆
* 所有变量都要存储在主内存中，这些变量对于所有线程都是共享的

### 工作内存

* 每一个线程都是自己独立工作的地方，也就是工作内存
* 工作内存中保存的是主内存中某些变量的拷贝，线程堆变量的所有操作都必须在工作内存中进行，不能直接操作主内存
* **如果是基本数据类型，那么直接分配到工作内存，如果是引用类型，引用的地址存在在工作空间中，但是具体的对象是存在在堆中(也就是主内存中)，是可以共享的**

![什么是java内存模型](./java内存模型/image-20200423233046759.png)

看上图，之所以存在`java`内存模型一说是因为`java`虚拟机的工作机制。当有多个线程的时候，每一个线程可以操作的数据有两种类型

* 线程私有的数据，也就是这个数据就算改变了也不会影响其余线程，比如说局部变量就是线程私有的数据
* 线程共享的数据，这样的数据多个线程都可以访问，就会出现线程安全的问题

因为线程操作的数据有不同类型，所以在`java`中一个线程去操作数据的时候不是在主内存中直接操作，其实还有一个属于线程自己的内存(工作内存)，当操作线程私有的数据比较好理解，直接在工作内存中完成就可以咯，如果是操作共享的数据，那么就在主内存中拿一份数据到自己工作内存中操作，操作完了再将数据给到主内存中。